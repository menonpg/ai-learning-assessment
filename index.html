<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Mediated Learning Assessment Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        /* New Layout Styles */
        .main-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .left-panel { display: flex; flex-direction: column; gap: 20px; }
        .right-panel { display: flex; flex-direction: column; gap: 20px; }
        .collapsible-card { background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .collapsible-header { background: #667eea; color: white; padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .collapsible-content { padding: 20px; display: none; }
        .collapsible-content.active { display: block; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card h3 { color: #333; margin-bottom: 15px; font-size: 1.3em; }
        .assessment-form { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .dimension { margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 8px; }
        .dimension h4 { color: #495057; margin-bottom: 15px; }
        .question { margin-bottom: 15px; }
        .question label { display: block; margin-bottom: 5px; font-weight: 500; }
        .slider-container { display: flex; align-items: center; gap: 10px; }
        .slider { flex: 1; }
        .slider-value { font-weight: bold; color: #667eea; min-width: 30px; }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #ddd; outline: none; }
        input[type="range"]::-webkit-slider-thumb { appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; }
        .calculate-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-top: 20px; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
        .results { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 30px; }
        .matrix-display { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; }
        .matrix-cell { background: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; border: 2px solid #e9ecef; }
        .matrix-cell.header { background: #667eea; color: white; font-weight: bold; }
        .recommendations { background: #e8f5e8; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .risk-indicator { padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; font-weight: bold; }
        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        
        /* Chat Interface Styles */
        .chat-container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 30px; }
        
        /* Persistent Profile Sidebar */
        .profile-sidebar { position: fixed; top: 20px; right: 20px; width: 250px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; display: none; }
        .profile-sidebar h4 { margin-bottom: 10px; color: #333; font-size: 0.9em; }
        .profile-mini-matrix { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.8em; }
        .profile-mini-cell { padding: 8px; text-align: center; border-radius: 4px; background: #f8f9fa; }
        .profile-mini-cell.header { background: #667eea; color: white; font-weight: bold; }
        .chat-messages { height: 400px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f8f9fa; }
        .message { margin-bottom: 15px; padding: 10px; border-radius: 8px; }
        .message.user { background: #667eea; color: white; margin-left: 20px; }
        .message.assistant { background: white; border: 1px solid #ddd; margin-right: 20px; }
        
        /* Markdown styling in chat messages */
        .message h1, .message h2, .message h3 { margin: 10px 0; color: #333; }
        .message h1 { font-size: 1.2em; }
        .message h2 { font-size: 1.1em; }
        .message h3 { font-size: 1.05em; }
        .message strong { font-weight: bold; }
        .message em { font-style: italic; }
        .message code { background: #f1f3f4; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        .message pre { background: #f8f9fa; padding: 8px; border-radius: 5px; margin: 8px 0; overflow-x: auto; }
        .message pre code { background: none; padding: 0; }
        .message ul { margin: 8px 0; padding-left: 20px; }
        .message li { margin: 2px 0; }
        .message p { margin: 5px 0; }
        .message table, .message .chat-table { border-collapse: collapse; width: 100%; margin: 10px 0; font-size: 0.9em; }
        .message th, .message td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: top; }
        .message th { background: #f1f3f4; font-weight: bold; color: #333; }
        .message .chat-table th { background: #667eea; color: white; }
        .message .chat-table tbody tr:nth-child(even) { background: #f8f9fa; }
        .message .chat-table tbody tr:hover { background: #e9ecef; }
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .chat-input button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .chat-input button:disabled { background: #ccc; cursor: not-allowed; }
        .loading { display: none; text-align: center; padding: 10px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI-Mediated Learning Assessment Tool</h1>
            <p>Comprehensive diagnostic framework for personalized education</p>
            <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">
                Developed by <strong>Prahlad Menon, PhD, PMP</strong> | 
                <a href="mailto:prahlad.menon@quant.md" style="color: white; text-decoration: underline;">prahlad.menon@quant.md</a> | 
                <a href="https://www.thinkcreate.ai" target="_blank" style="color: white; text-decoration: underline;">www.thinkcreate.ai</a>
            </div>
        </div>

        <!-- New Collapsible Layout -->
        <div class="main-layout">
            <!-- Left Panel: Assessment Questions -->
            <div class="left-panel">
                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('overview')">
                        <span>üìä Assessment Overview</span>
                        <span id="overview-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="overview-content">
                        <p>Complete the 5x4 diagnostic matrix to identify learning needs across cognitive, socioeconomic, emotional, learning style, and cultural learning dimensions.</p>
                        <ul style="margin-top: 15px; padding-left: 20px;">
                            <li>20 key indicators</li>
                            <li>Personalized recommendations</li>
                            <li>Risk assessment</li>
                            <li>Progress tracking</li>
                            <li>Cultural learning context analysis</li>
                        </ul>
                    </div>
                </div>

                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('cognitive')">
                        <span>üß† Cognitive Processing</span>
                        <span id="cognitive-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="cognitive-content">
                        <div class="question">
                            <label>Information Processing Speed - How quickly do you understand new concepts?</label>
                            <div class="slider-container">
                                <span>Slow</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="c1">
                                <span>Fast</span>
                                <span class="slider-value" id="c1-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Working Memory Capacity - How much information can you hold in mind while solving problems?</label>
                            <div class="slider-container">
                                <span>Limited</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="c2">
                                <span>Extensive</span>
                                <span class="slider-value" id="c2-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Attention Regulation - How well can you maintain focus during learning?</label>
                            <div class="slider-container">
                                <span>Difficult</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="c3">
                                <span>Easy</span>
                                <span class="slider-value" id="c3-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Metacognitive Awareness - How well do you understand your own learning process?</label>
                            <div class="slider-container">
                                <span>Unaware</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="c4">
                                <span>Very Aware</span>
                                <span class="slider-value" id="c4-value">5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('socioeconomic')">
                        <span>üí∞ Socioeconomic Factors</span>
                        <span id="socioeconomic-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="socioeconomic-content">
                        <div class="question">
                            <label>Resource Availability - Access to books, technology, study materials</label>
                            <div class="slider-container">
                                <span>Very Limited</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="s1">
                                <span>Abundant</span>
                                <span class="slider-value" id="s1-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Family Educational Support - Help available from family members</label>
                            <div class="slider-container">
                                <span>No Support</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="s2">
                                <span>Strong Support</span>
                                <span class="slider-value" id="s2-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Economic Stress Impact - How much do financial concerns affect your studies?</label>
                            <div class="slider-container">
                                <span>High Stress</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="s3">
                                <span>No Stress</span>
                                <span class="slider-value" id="s3-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Technology Access - Reliable internet and devices for learning</label>
                            <div class="slider-container">
                                <span>Very Limited</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="s4">
                                <span>Excellent</span>
                                <span class="slider-value" id="s4-value">5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('emotional')">
                        <span>üòä Emotional Well-being</span>
                        <span id="emotional-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="emotional-content">
                        <div class="question">
                            <label>Academic Anxiety Levels - How anxious do you feel about academic performance?</label>
                            <div class="slider-container">
                                <span>Very Anxious</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="e1">
                                <span>Very Calm</span>
                                <span class="slider-value" id="e1-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Motivation and Engagement - How motivated are you to learn?</label>
                            <div class="slider-container">
                                <span>Not Motivated</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="e2">
                                <span>Highly Motivated</span>
                                <span class="slider-value" id="e2-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Self-Efficacy Beliefs - How confident are you in your ability to succeed?</label>
                            <div class="slider-container">
                                <span>Not Confident</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="e3">
                                <span>Very Confident</span>
                                <span class="slider-value" id="e3-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Stress Management Capacity - How well do you handle academic stress?</label>
                            <div class="slider-container">
                                <span>Poorly</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="e4">
                                <span>Very Well</span>
                                <span class="slider-value" id="e4-value">5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('learning')">
                        <span>üé® Learning Style Preferences</span>
                        <span id="learning-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="learning-content">
                        <div class="question">
                            <label>Modality Preferences - Do you learn better through visual, auditory, or hands-on methods?</label>
                            <div class="slider-container">
                                <span>Single Mode</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="l1">
                                <span>Multi-Modal</span>
                                <span class="slider-value" id="l1-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Social vs Individual Learning - Do you prefer group work or individual study?</label>
                            <div class="slider-container">
                                <span>Individual</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="l2">
                                <span>Group</span>
                                <span class="slider-value" id="l2-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Sequential vs Global Processing - Do you prefer step-by-step or big-picture learning?</label>
                            <div class="slider-container">
                                <span>Sequential</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="l3">
                                <span>Global</span>
                                <span class="slider-value" id="l3-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Abstract vs Concrete Thinking - Do you prefer theoretical concepts or practical examples?</label>
                            <div class="slider-container">
                                <span>Concrete</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="l4">
                                <span>Abstract</span>
                                <span class="slider-value" id="l4-value">5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('cultural')">
                        <span>üåç Cultural Learning Context</span>
                        <span id="cultural-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="cultural-content">
                        <div class="question">
                            <label>Educational Authority Expectations - How do you prefer instructors to communicate feedback and guidance?</label>
                            <div class="slider-container">
                                <span>Gentle Support</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="cu1">
                                <span>Direct/Firm</span>
                                <span class="slider-value" id="cu1-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Learning Struggle Tolerance - How comfortable are you with academic challenge and temporary confusion?</label>
                            <div class="slider-container">
                                <span>Need Clarity</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="cu2">
                                <span>Embrace Struggle</span>
                                <span class="slider-value" id="cu2-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Cultural Communication Style - How do you interpret direct academic feedback?</label>
                            <div class="slider-container">
                                <span>Personal Criticism</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="cu3">
                                <span>Caring Guidance</span>
                                <span class="slider-value" id="cu3-value">5</span>
                            </div>
                        </div>
                        <div class="question">
                            <label>Learning Independence Expectation - How much guidance do you expect from instructors?</label>
                            <div class="slider-container">
                                <span>Full Service</span>
                                <input type="range" class="slider" min="1" max="10" value="5" id="cu4">
                                <span>Self-Directed</span>
                                <span class="slider-value" id="cu4-value">5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateProfile()">üîç Analyze Learning Profile & Generate Recommendations</button>
            </div>

            <!-- Right Panel: Results and Analysis -->
            <div class="right-panel">
                <div class="collapsible-card">
                    <div class="collapsible-header" onclick="toggleCollapse('howworks')">
                        <span>üéØ How It Works</span>
                        <span id="howworks-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="howworks-content">
                        <h4>üî¨ The 5x4 Diagnostic Matrix</h4>
                        <p>This assessment uses a comprehensive 5x4 matrix (20 indicators) where each dimension influences and interacts with others:</p>
                        
                        <div style="margin: 20px 0;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.8em;">
                                <thead>
                                    <tr style="background: #667eea; color: white;">
                                        <th style="padding: 6px; border: 1px solid #ddd;">Dimension Interactions</th>
                                        <th style="padding: 6px; border: 1px solid #ddd;">Cognitive</th>
                                        <th style="padding: 6px; border: 1px solid #ddd;">Socioeconomic</th>
                                        <th style="padding: 6px; border: 1px solid #ddd;">Emotional</th>
                                        <th style="padding: 6px; border: 1px solid #ddd;">Learning Style</th>
                                        <th style="padding: 6px; border: 1px solid #ddd;">Cultural</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; background: #f1f3f4;">Cognitive</td>
                                        <td style="padding: 6px; border: 1px solid #ddd; background: #e3f2fd;">Processing √ó Memory</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Resources affect load</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Stress impacts focus</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Modality preferences</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Communication styles</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; background: #f1f3f4;">Socioeconomic</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Access affects tools</td>
                                        <td style="padding: 6px; border: 1px solid #ddd; background: #e8f5e8;">Resources √ó Support</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Financial stress</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Technology shapes methods</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Economic barriers</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; background: #f1f3f4;">Emotional</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Anxiety affects focus</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Support systems crucial</td>
                                        <td style="padding: 6px; border: 1px solid #ddd; background: #fff3e0;">Motivation √ó Confidence</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Emotions shape preferences</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Cultural stress response</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; background: #f1f3f4;">Learning Style</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Style affects processing</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Resources determine options</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Comfort affects engagement</td>
                                        <td style="padding: 6px; border: 1px solid #ddd; background: #f3e5f5;">Individual √ó Social</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Cultural methods match</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; background: #f1f3f4;">Cultural</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Communication affects understanding</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Cultural capital impacts access</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Feedback interpretation varies</td>
                                        <td style="padding: 6px; border: 1px solid #ddd;">Authority expectations shape style</td>
                                        <td style="padding: 6px; border: 1px solid #ddd; background: #fce4ec;">Authority √ó Independence</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4>üìä How It Works:</h4>
                        <ol style="margin-top: 15px; padding-left: 20px;">
                            <li><strong>Assessment:</strong> 20 indicators across 5 dimensions</li>
                            <li><strong>Weighted Analysis:</strong> Each factor weighted by research importance</li>
                            <li><strong>Interaction Mapping:</strong> Cross-dimensional relationships identified</li>
                            <li><strong>Risk Calculation:</strong> Higher performance = Lower risk (inverse relationship)</li>
                            <li><strong>Cultural Context:</strong> Learning preferences shaped by cultural background</li>
                            <li><strong>AI Recommendations:</strong> Personalized strategies based on your unique profile</li>
                        </ol>

                        <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #667eea;">
                            <strong>üí° Why 5x4?</strong><br>
                            Each dimension contains 4 key indicators, creating 20 total measurements. The "interactions" occur when your scores in one dimension influence recommendations for another (e.g., low socioeconomic resources + high cognitive ability + cultural preference for guidance = recommend free structured online courses with instructor support).
                        </div>
                    </div>
                </div>

                <div class="collapsible-card" id="results" style="display: none;">
                    <div class="collapsible-header" onclick="toggleCollapse('results')">
                        <span>üìã Your Learning Profile Analysis</span>
                        <span id="results-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content active" id="results-content">
                        <div class="matrix-display">
                            <div class="matrix-cell header">Cognitive</div>
                            <div class="matrix-cell header">Socioeconomic</div>
                            <div class="matrix-cell header">Emotional</div>
                            <div class="matrix-cell header">Learning Style</div>
                            <div class="matrix-cell header">Cultural</div>
                            <div class="matrix-cell" id="cog-score">0.0</div>
                            <div class="matrix-cell" id="ses-score">0.0</div>
                            <div class="matrix-cell" id="emo-score">0.0</div>
                            <div class="matrix-cell" id="learn-score">0.0</div>
                            <div class="matrix-cell" id="cultural-score">0.0</div>
                        </div>

                        <div id="risk-assessment"></div>
                        
                        <div class="recommendations">
                            <h3>üéØ Personalized AI Recommendations</h3>
                            <div id="ai-recommendations">
                                <p>Complete the assessment to receive personalized recommendations...</p>
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <h3>üìä Detailed Breakdown</h3>
                            <div id="detailed-analysis"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Persistent Profile Sidebar -->
        <div class="profile-sidebar" id="profile-sidebar">
            <h4>üìä Your Learning Profile</h4>
            <div class="profile-mini-matrix">
                <div class="profile-mini-cell header">Cognitive</div>
                <div class="profile-mini-cell header">Socioeconomic</div>
                <div class="profile-mini-cell header">Emotional</div>
                <div class="profile-mini-cell header">Learning</div>
                <div class="profile-mini-cell" id="sidebar-cog">-</div>
                <div class="profile-mini-cell" id="sidebar-ses">-</div>
                <div class="profile-mini-cell" id="sidebar-emo">-</div>
                <div class="profile-mini-cell" id="sidebar-learn">-</div>
            </div>
            <div style="margin-top: 10px; font-size: 0.8em; text-align: center;">
                <strong>Risk: <span id="sidebar-risk">-</span></strong>
            </div>
        </div>

        <!-- Dr. Menon Chat Interface -->
        <div class="chat-container" id="chat-container" style="display: none;">
            <h2>üí¨ Chat with Dr. Menon</h2>
            <p style="margin-bottom: 20px; color: #666;">Ask questions about your learning profile, get study advice, or discuss specific academic challenges with Dr. Prahlad Menon.</p>
            
            <div class="chat-messages" id="chat-messages">
                <div class="message assistant">
                    <strong>Dr. Menon:</strong> Hi! I've analyzed your learning profile. Feel free to ask me questions about your results, request specific study strategies, or discuss any academic challenges you're facing. How can I help you today?
                </div>
            </div>
            
            <div class="loading" id="loading">
                ü§ñ GPT-5 is thinking...
            </div>
            
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Ask about your learning profile or study strategies..." onkeypress="handleEnter(event)">
                <button onclick="sendMessage()" id="send-btn">Send</button>
            </div>
        </div>
    </div>

    <!-- Configuration Script - Load before main script -->
    <script src="config.js" onerror="console.warn('config.js not found - chat functionality will be disabled')"></script>
    
    <script>
        // Load configuration on page load
        window.addEventListener('DOMContentLoaded', function() {
            if (!loadConfig()) {
                console.warn('AI configuration not loaded - chat functionality disabled');
                const chatContainer = document.getElementById('chat-container');
                if (chatContainer) {
                    chatContainer.innerHTML = `
                        <h2>üí¨ Chat with Dr. Menon</h2>
                        <div style="padding: 20px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; color: #856404;">
                            <strong>‚ö†Ô∏è Configuration Required</strong><br>
                            To enable the AI chat feature, please:
                            <ol style="margin: 10px 0; padding-left: 20px;">
                                <li>Copy <code>config.template.js</code> to <code>config.js</code></li>
                                <li>Add your Azure OpenAI credentials to <code>config.js</code></li>
                                <li>Refresh the page</li>
                            </ol>
                            <p><strong>Note:</strong> The assessment tool works perfectly without the chat feature!</p>
                        </div>
                    `;
                }
            }
        });

        // Toggle collapsible sections with auto-collapse
        function toggleCollapse(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            
            // If clicking to open a section, first close all other sections
            if (content.style.display === 'none' || !content.style.display) {
                // Close all other collapsible sections
                const allSections = ['overview', 'cognitive', 'socioeconomic', 'emotional', 'learning', 'howworks', 'results'];
                allSections.forEach(section => {
                    if (section !== sectionId) {
                        const otherContent = document.getElementById(section + '-content');
                        const otherIcon = document.getElementById(section + '-icon');
                        if (otherContent && otherIcon) {
                            otherContent.style.display = 'none';
                            otherContent.classList.remove('active');
                            otherIcon.textContent = '‚ñ∂';
                        }
                    }
                });
                
                // Open the clicked section
                content.style.display = 'block';
                content.classList.add('active');
                icon.textContent = '‚ñº';
            } else {
                // Close the clicked section
                content.style.display = 'none';
                content.classList.remove('active');
                icon.textContent = '‚ñ∂';
            }
        }

        // Auto-advance to next section after completing current one
        function autoAdvanceSection(currentSection) {
            const sectionOrder = ['overview', 'cognitive', 'socioeconomic', 'emotional', 'learning', 'cultural'];
            const currentIndex = sectionOrder.indexOf(currentSection);
            
            if (currentIndex !== -1 && currentIndex < sectionOrder.length - 1) {
                const nextSection = sectionOrder[currentIndex + 1];
                
                // Delay to let user see their input, then auto-advance
                setTimeout(() => {
                    toggleCollapse(currentSection); // Close current
                    setTimeout(() => {
                        toggleCollapse(nextSection); // Open next
                        document.getElementById(nextSection + '-content').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }, 300);
                }, 1500); // 1.5 second delay
            }
        }

        // Update slider values in real-time and check for section completion
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            slider.addEventListener('input', function() {
                document.getElementById(this.id + '-value').textContent = this.value;
                
                // Check if all sliders in current section are set (not default value of 5)
                checkSectionCompletion(this.id);
            });
        });

        // Check if section is completed and auto-advance
        function checkSectionCompletion(sliderId) {
            let sectionId = '';
            let sliderIds = [];
            
            // Determine which section we're in
            if (sliderId.startsWith('c') && !sliderId.startsWith('cu')) {
                sectionId = 'cognitive';
                sliderIds = ['c1', 'c2', 'c3', 'c4'];
            } else if (sliderId.startsWith('s')) {
                sectionId = 'socioeconomic';
                sliderIds = ['s1', 's2', 's3', 's4'];
            } else if (sliderId.startsWith('e')) {
                sectionId = 'emotional';
                sliderIds = ['e1', 'e2', 'e3', 'e4'];
            } else if (sliderId.startsWith('l')) {
                sectionId = 'learning';
                sliderIds = ['l1', 'l2', 'l3', 'l4'];
            } else if (sliderId.startsWith('cu')) {
                sectionId = 'cultural';
                sliderIds = ['cu1', 'cu2', 'cu3', 'cu4'];
            }
            
            // Check if all sliders in this section have been moved from default value
            if (sectionId && sliderIds.length > 0) {
                const allMoved = sliderIds.every(id => {
                    const slider = document.getElementById(id);
                    return slider && slider.value !== '5'; // Default value is 5
                });
                
                // If all sliders in section are set, auto-advance after a brief delay
                if (allMoved) {
                    autoAdvanceSection(sectionId);
                }
            }
        }

        function calculateProfile() {
            // Get all values including cultural dimension
            const cognitive = [
                parseInt(document.getElementById('c1').value),
                parseInt(document.getElementById('c2').value),
                parseInt(document.getElementById('c3').value),
                parseInt(document.getElementById('c4').value)
            ];
            
            const socioeconomic = [
                parseInt(document.getElementById('s1').value),
                parseInt(document.getElementById('s2').value),
                parseInt(document.getElementById('s3').value),
                parseInt(document.getElementById('s4').value)
            ];
            
            const emotional = [
                parseInt(document.getElementById('e1').value),
                parseInt(document.getElementById('e2').value),
                parseInt(document.getElementById('e3').value),
                parseInt(document.getElementById('e4').value)
            ];
            
            const learning = [
                parseInt(document.getElementById('l1').value),
                parseInt(document.getElementById('l2').value),
                parseInt(document.getElementById('l3').value),
                parseInt(document.getElementById('l4').value)
            ];

            const cultural = [
                parseInt(document.getElementById('cu1').value),
                parseInt(document.getElementById('cu2').value),
                parseInt(document.getElementById('cu3').value),
                parseInt(document.getElementById('cu4').value)
            ];

            // Calculate weighted scores (implementing the paper's matrix multiplication)
            const weights = [0.3, 0.25, 0.25, 0.2]; // From the paper
            
            const cogScore = (cognitive[0] * weights[0] + cognitive[1] * weights[1] + 
                            cognitive[2] * weights[2] + cognitive[3] * weights[3]).toFixed(1);
            const sesScore = (socioeconomic[0] * weights[0] + socioeconomic[1] * weights[1] + 
                            socioeconomic[2] * weights[2] + socioeconomic[3] * weights[3]).toFixed(1);
            const emoScore = (emotional[0] * weights[0] + emotional[1] * weights[1] + 
                            emotional[2] * weights[2] + emotional[3] * weights[3]).toFixed(1);
            const learnScore = (learning[0] * weights[0] + learning[1] * weights[1] + 
                              learning[2] * weights[2] + learning[3] * weights[3]).toFixed(1);
            const culturalScore = (cultural[0] * weights[0] + cultural[1] * weights[1] + 
                                 cultural[2] * weights[2] + cultural[3] * weights[3]).toFixed(1);

            // Update display
            document.getElementById('cog-score').textContent = cogScore;
            document.getElementById('ses-score').textContent = sesScore;
            document.getElementById('emo-score').textContent = emoScore;
            document.getElementById('learn-score').textContent = learnScore;
            document.getElementById('cultural-score').textContent = culturalScore;

            // Fixed risk calculation - Higher scores should mean LOWER risk (now includes cultural)
            const averageScore = (parseFloat(cogScore) + parseFloat(sesScore) + parseFloat(emoScore) + parseFloat(learnScore) + parseFloat(culturalScore)) / 5;
            
            // Convert to risk scale (10 - average gives us risk where higher performance = lower risk)
            const riskScore = Math.max(0, 10 - averageScore).toFixed(2);
            
            let riskLevel, riskClass, riskMessage;
            if (riskScore <= 2) {
                riskLevel = "Low Risk";
                riskClass = "risk-low";
                riskMessage = "Excellent indicators for academic success! You're performing well across all dimensions.";
            } else if (riskScore <= 4) {
                riskLevel = "Medium Risk";
                riskClass = "risk-medium";
                riskMessage = "Good overall performance with some areas for improvement. Targeted support recommended.";
            } else if (riskScore <= 6) {
                riskLevel = "Moderate Risk";
                riskClass = "risk-medium";
                riskMessage = "Several areas need attention. Consider implementing the AI-powered recommendations below.";
            } else {
                riskLevel = "High Risk";
                riskClass = "risk-high";
                riskMessage = "Multiple challenges identified. Immediate support and intervention recommended.";
            }

            document.getElementById('risk-assessment').innerHTML = `
                <div class="risk-indicator ${riskClass}">
                    Risk Score: ${riskScore} - ${riskLevel}
                    <br><small>${riskMessage}</small>
                </div>
            `;

            // Generate recommendations based on scores including cultural
            generateRecommendations(cogScore, sesScore, emoScore, learnScore, culturalScore, cognitive, socioeconomic, emotional, learning, cultural);
            
            // Show results and auto-expand
            document.getElementById('results').style.display = 'block';
            
            // Auto-expand results section and collapse others
            setTimeout(() => {
                const allSections = ['overview', 'cognitive', 'socioeconomic', 'emotional', 'learning', 'cultural', 'howworks', 'results'];
                allSections.forEach(section => {
                    const otherContent = document.getElementById(section + '-content');
                    const otherIcon = document.getElementById(section + '-icon');
                    if (otherContent && otherIcon) {
                        if (section === 'results') {
                            // Expand results section
                            otherContent.style.display = 'block';
                            otherContent.classList.add('active');
                            otherIcon.textContent = '‚ñº';
                        } else {
                            // Collapse all other sections
                            otherContent.style.display = 'none';
                            otherContent.classList.remove('active');
                            otherIcon.textContent = '‚ñ∂';
                        }
                    }
                });
                
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }

        function generateRecommendations(cogScore, sesScore, emoScore, learnScore, culturalScore, cognitive, socioeconomic, emotional, learning, cultural) {
            let recommendations = [];

            // Cognitive recommendations
            if (cogScore < 5) {
                recommendations.push("üß† <strong>Cognitive Support:</strong> Use AI-powered study tools with visual aids and step-by-step explanations. Consider spaced repetition techniques.");
            }
            if (cognitive[2] < 5) { // Attention regulation
                recommendations.push("‚è∞ <strong>Attention Management:</strong> Try the Pomodoro technique with 25-minute focused study sessions. Use AI apps that send break reminders.");
            }

            // Socioeconomic recommendations
            if (sesScore < 5) {
                recommendations.push("üìö <strong>Resource Access:</strong> Utilize free online resources like Khan Academy, Coursera audits, and library digital collections. Explore financial aid options.");
            }
            if (socioeconomic[3] < 5) { // Technology access
                recommendations.push("üíª <strong>Technology Solutions:</strong> Use mobile-optimized learning apps. Look into campus computer labs and WiFi hotspot lending programs.");
            }

            // Emotional recommendations
            if (emoScore < 5) {
                recommendations.push("üòå <strong>Emotional Support:</strong> Practice stress-reduction techniques. Consider counseling services. Use AI-powered mood tracking apps.");
            }
            if (emotional[0] < 5) { // High anxiety
                recommendations.push("üßò <strong>Anxiety Management:</strong> Try mindfulness apps, breathing exercises before exams, and gradual exposure to test situations.");
            }

            // Learning style recommendations
            if (learning[0] > 7) { // Multi-modal preference
                recommendations.push("üé® <strong>Multi-Modal Learning:</strong> Use AI tools that combine visual, auditory, and interactive elements. Try video tutorials with hands-on practice.");
            }
            if (learning[1] > 6) { // Group learning preference
                recommendations.push("üë• <strong>Collaborative Learning:</strong> Join study groups, use AI-powered team formation tools, and engage in peer tutoring.");
            }

            // Cultural learning recommendations (based on Dr. Menon's interview insights)
            if (cultural[0] < 5) { // Prefers gentle support over direct feedback
                recommendations.push("üå∏ <strong>Cultural Communication:</strong> Seek instructors who use supportive, encouraging language. Consider AI tutors with gentle feedback modes. Frame mistakes as learning opportunities.");
            }
            if (cultural[1] < 5) { // Low tolerance for learning struggle
                recommendations.push("üéØ <strong>Structured Learning:</strong> Use AI-powered step-by-step tutorials that break complex topics into clear, manageable chunks. Avoid ambiguous learning situations.");
            }
            if (cultural[2] < 5) { // Interprets feedback as personal criticism
                recommendations.push("üí¨ <strong>Feedback Reframing:</strong> Practice viewing academic feedback as caring guidance. Use AI tools that provide growth-oriented feedback rather than deficit-focused corrections.");
            }
            if (cultural[3] < 5) { // Expects full-service guidance
                recommendations.push("üó∫Ô∏è <strong>Guided Learning Path:</strong> Use AI-powered learning platforms with clear curriculums and instructor-led courses. Gradually build independence through scaffolded AI assistance.");
            }

            // Cross-cultural recommendations
            if (culturalScore > 7) {
                recommendations.push("üåç <strong>Leadership Opportunity:</strong> Your strong cultural adaptability makes you ideal for peer mentoring and cross-cultural study groups. Consider AI-powered collaboration tools.");
            }

            // AI-specific recommendations
            recommendations.push("ü§ñ <strong>AI Tools:</strong> Try ChatGPT for concept explanations, NotebookLM for research synthesis, and Duolingo for language learning.");
            recommendations.push("üìä <strong>Progress Tracking:</strong> Use AI-powered learning analytics to monitor your improvement and adjust strategies accordingly.");

            document.getElementById('ai-recommendations').innerHTML = recommendations.map(rec => `<p>${rec}</p>`).join('');

            // Detailed analysis including cultural dimension
            const analysis = `
                <p><strong>Cognitive Processing (${cogScore}/10):</strong> ${cogScore > 6 ? 'Strong analytical abilities. Continue challenging yourself with complex problems.' : 'Consider using AI tutoring systems for additional cognitive support and scaffolding.'}</p>
                <p><strong>Socioeconomic Factors (${sesScore}/10):</strong> ${sesScore > 6 ? 'Good resource availability. Leverage your advantages to help others.' : 'Focus on free, high-quality AI-powered educational resources to level the playing field.'}</p>
                <p><strong>Emotional Well-being (${emoScore}/10):</strong> ${emoScore > 6 ? 'Positive emotional state supports learning. Maintain current wellness practices.' : 'Prioritize emotional support alongside academic goals. Consider AI-powered wellness apps.'}</p>
                <p><strong>Learning Style (${learnScore}/10):</strong> ${learnScore > 6 ? 'Clear learning preferences identified. Seek AI tools that match your style.' : 'Experiment with different AI-powered learning modalities to find what works best.'}</p>
                <p><strong>Cultural Learning Context (${culturalScore}/10):</strong> ${culturalScore > 6 ? 'Strong cultural adaptability enables you to thrive in diverse learning environments. Consider mentoring others.' : 'Focus on finding culturally-responsive learning environments and AI tools that match your communication and feedback preferences.'}</p>
            `;
            
            document.getElementById('detailed-analysis').innerHTML = analysis;
        }

        // GPT-5 Chat Integration - Configuration loaded from config.js
        let AZURE_ENDPOINT, API_KEY, DEPLOYMENT, API_VERSION;
        
        // Load configuration
        function loadConfig() {
            if (typeof window.AI_LEARNING_CONFIG !== 'undefined') {
                AZURE_ENDPOINT = window.AI_LEARNING_CONFIG.AZURE_ENDPOINT;
                API_KEY = window.AI_LEARNING_CONFIG.API_KEY;
                DEPLOYMENT = window.AI_LEARNING_CONFIG.DEPLOYMENT;
                API_VERSION = window.AI_LEARNING_CONFIG.API_VERSION;
                return true;
            }
            return false;
        }
        
        // Check if configuration is loaded
        function isConfigured() {
            return AZURE_ENDPOINT && API_KEY && DEPLOYMENT && API_VERSION;
        }

        let currentProfile = null;

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();
            
            if (!message) return;
            
            // Check if configuration is available
            if (!isConfigured()) {
                addMessage('assistant', '‚ö†Ô∏è Chat functionality is not configured. Please set up your Azure OpenAI credentials in config.js to enable this feature.');
                return;
            }
            
            // Add user message to chat
            addMessage('user', message);
            userInput.value = '';
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('send-btn').disabled = true;
            
            try {
                // Prepare context with learning profile if available
                let systemPrompt = `You are Dr. Prahlad Menon, PhD, PMP, an expert in AI-mediated learning and educational technology. You help students understand their learning profiles and provide personalized study strategies. Always respond with supportive, specific, and actionable advice. When providing learning strategies, format them as markdown tables when appropriate for better organization.`;
                
                if (currentProfile) {
                    systemPrompt += `\n\nThe student's current learning profile:
- Cognitive Processing: ${currentProfile.cognitive}/10
- Socioeconomic Factors: ${currentProfile.socioeconomic}/10  
- Emotional Well-being: ${currentProfile.emotional}/10
- Learning Style: ${currentProfile.learning}/10
- Cultural Context: ${currentProfile.cultural}/10
- Risk Level: ${currentProfile.riskLevel} (Score: ${currentProfile.riskScore})

Based on this profile, provide personalized learning strategies. When giving recommendations, structure them in a clear, organized format using tables or lists for better readability.`;
                }
                
                const response = await fetch(`${AZURE_ENDPOINT}openai/deployments/${DEPLOYMENT}/chat/completions?api-version=${API_VERSION}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'api-key': API_KEY
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: message }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                const assistantMessage = data.choices[0].message.content;
                
                // Add assistant response to chat
                addMessage('assistant', assistantMessage);
                
            } catch (error) {
                console.error('Chat error:', error);
                addMessage('assistant', '‚ö†Ô∏è Sorry, I encountered an error connecting to GPT-5. Please check your internet connection and try again. If the problem persists, the API key may need to be renewed.');
            } finally {
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('send-btn').disabled = false;
            }
        }

        function parseMarkdown(text) {
            // First handle tables before other processing
            text = parseMarkdownTables(text);
            
            // Convert markdown to HTML
            return text
                // Horizontal rules (must come before headers)
                .replace(/^---+$/gm, '<hr>')
                .replace(/^===+$/gm, '<hr>')
                // Headers with improved spacing
                .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                // Bold and italic
                .replace(/\*\*\*([^*]+)\*\*\*/g, '<strong><em>$1</em></strong>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                // Code blocks
                .replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                // Lists (improved to handle nested content)
                .replace(/^\* (.+)$/gim, '<li>$1</li>')
                .replace(/^- (.+)$/gim, '<li>$1</li>')
                .replace(/^(\d+)\. (.+)$/gim, '<li>$2</li>')
                // Handle multiple line breaks
                .replace(/\n\s*\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                // Wrap in paragraphs (but not if already in HTML tags)
                .replace(/^(?!<[hou])/gm, '<p>')
                .replace(/(?<!>)$/gm, '</p>')
                // Fix list items
                .replace(/(<li>.*?<\/li>)/gs, function(match) {
                    return '<ul>' + match + '</ul>';
                })
                // Clean up empty paragraphs and fix nested tags
                .replace(/<p><\/p>/g, '')
                .replace(/<p>(<h[1-6]>.*?<\/h[1-6]>)<\/p>/g, '$1')
                .replace(/<p>(<hr>)<\/p>/g, '$1')
                .replace(/<p>(<ul>.*?<\/ul>)<\/p>/gs, '$1')
                .replace(/(<\/p>){2,}/g, '</p>')
                .replace(/(<p>){2,}/g, '<p>');
        }

        function parseMarkdownTables(text) {
            // Split text into lines
            const lines = text.split('\n');
            let result = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // Check if this line looks like a table header (contains |)
                if (line.includes('|') && line.split('|').length > 2) {
                    // Look ahead to see if next line is a separator (contains --- or ===)
                    if (i + 1 < lines.length && (lines[i + 1].includes('---') || lines[i + 1].includes('==='))) {
                        // This is a table, process it
                        const tableResult = parseTable(lines, i);
                        result.push(tableResult.html);
                        i = tableResult.nextIndex;
                        continue;
                    }
                }
                
                result.push(lines[i]);
                i++;
            }
            
            return result.join('\n');
        }

        function parseTable(lines, startIndex) {
            let html = '<table class="chat-table">';
            let i = startIndex;
            
            // Process header row
            if (i < lines.length && lines[i].includes('|')) {
                const headerCells = lines[i].split('|').map(cell => cell.trim()).filter(cell => cell !== '');
                html += '<thead><tr>';
                headerCells.forEach(cell => {
                    html += `<th>${cell}</th>`;
                });
                html += '</tr></thead>';
                i++;
            }
            
            // Skip separator row
            if (i < lines.length && (lines[i].includes('---') || lines[i].includes('==='))) {
                i++;
            }
            
            // Process data rows
            html += '<tbody>';
            while (i < lines.length && lines[i].trim().includes('|')) {
                const rowCells = lines[i].split('|').map(cell => cell.trim()).filter(cell => cell !== '');
                if (rowCells.length > 0) {
                    html += '<tr>';
                    rowCells.forEach(cell => {
                        html += `<td>${cell}</td>`;
                    });
                    html += '</tr>';
                }
                i++;
            }
            html += '</tbody></table>';
            
            return {
                html: html,
                nextIndex: i
            };
        }

        function addMessage(sender, content) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'assistant') {
                const formattedContent = parseMarkdown(content);
                messageDiv.innerHTML = `<strong>Dr. Menon:</strong><br>${formattedContent}`;
            } else {
                messageDiv.innerHTML = `<strong>You:</strong> ${content}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Update the calculateProfile function to store current profile for chat context
        const originalCalculateProfile = calculateProfile;
        calculateProfile = function() {
            originalCalculateProfile();
            
            // Store profile for chat context including cultural dimension
            const cogScore = document.getElementById('cog-score').textContent;
            const sesScore = document.getElementById('ses-score').textContent; 
            const emoScore = document.getElementById('emo-score').textContent;
            const learnScore = document.getElementById('learn-score').textContent;
            const culturalScore = document.getElementById('cultural-score').textContent;
            
            const averageScore = (parseFloat(cogScore) + parseFloat(sesScore) + parseFloat(emoScore) + parseFloat(learnScore) + parseFloat(culturalScore)) / 5;
            const riskScore = Math.max(0, 10 - averageScore).toFixed(2);
            
            let riskLevel;
            if (riskScore <= 2) {
                riskLevel = "Low Risk";
            } else if (riskScore <= 4) {
                riskLevel = "Medium Risk";  
            } else if (riskScore <= 6) {
                riskLevel = "Moderate Risk";
            } else {
                riskLevel = "High Risk";
            }
            
            currentProfile = {
                cognitive: cogScore,
                socioeconomic: sesScore,
                emotional: emoScore,
                learning: learnScore,
                cultural: culturalScore,
                riskScore: riskScore,
                riskLevel: riskLevel
            };
            
            // Show chat interface after assessment
            document.getElementById('chat-container').style.display = 'block';
            
            // Update chat welcome message with Dr. Menon branding and cultural dimension
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = `
                <div class="message assistant">
                    <strong>Dr. Menon:</strong> Excellent! I've completed your comprehensive learning profile analysis. Here's your personalized assessment:
                    <br><br>
                    üìä <strong>Your Learning Profile Scores:</strong>
                    <br>‚Ä¢ Cognitive Processing: ${cogScore}/10
                    <br>‚Ä¢ Socioeconomic Factors: ${sesScore}/10
                    <br>‚Ä¢ Emotional Well-being: ${emoScore}/10
                    <br>‚Ä¢ Learning Style: ${learnScore}/10
                    <br>‚Ä¢ Cultural Learning Context: ${culturalScore}/10
                    <br>‚Ä¢ Overall Risk Level: ${riskLevel}
                    <br><br>
                    I'm ready to create a personalized learning strategy table based on these findings. What specific area would you like to focus on first? Ask me about study techniques, time management, cultural learning adaptations, or any academic challenges you're experiencing!
                </div>
            `;
        };
    </script>
</body>
</html>
